<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
			http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
			">
	
	<bean id="voiceHandler" class="org.bigbluebutton.conference.service.voice.VoiceHandler">
		<property name="conferenceServer"> <ref local="conferenceServer"/></property>
		<property name="clientNotifier"> <ref local="clientNotifier"/></property>
	</bean>
		
	<bean id="clientNotifier" class="org.bigbluebutton.webconference.red5.voice.ClientManager"/>
		
	<bean id="conferenceServer" class="org.bigbluebutton.webconference.voice.ConferenceServer">
		<property name="conferenceApplication"> <ref local="conferenceApplication"/></property>
		<property name="conferenceServerListener"> <ref local="clientNotifier"/></property>
	</bean>
	
	<bean id="voice.service" class="org.bigbluebutton.conference.service.voice.VoiceService">
		<property name="conferenceServer"> <ref local="conferenceServer"/></property>
	</bean>
	
	<bean id="conferenceApplication" class="org.bigbluebutton.webconference.voice.asterisk.AsteriskApplication">
		<property name="conferenceApplication"> <ref local="meetMeApplicationFacade"/></property>
		<property name="managerConnection"> <ref local="amiConnection"/></property>
	</bean>
	
	<!-- BEGIN APP-KONFERENCE -->
	<bean id="konferenceApplication" class="org.bigbluebutton.webconference.voice.asterisk.konference.KonferenceApplication">
		<property name="konferenceManager"> <ref local="konferenceManager"/></property>
	</bean>
	
	<bean id="konferenceManager" class="org.bigbluebutton.webconference.voice.asterisk.konference.KonferenceManager">
		<property name="managerConnection"> <ref local="amiConnection"/> </property>
		<property name="konferenceEventsTransformer"> <ref local="konferenceEventsTransformer"/></property>
	</bean>
	
	<bean id="konferenceEventsTransformer" class="org.bigbluebutton.webconference.voice.asterisk.konference.KonferenceEventsTransformer">
		<property name="conferenceEventListener"> <ref local="conferenceServer"/></property>
	</bean>
	<!-- END APP-KONFERENCE -->
	
	<!-- BEGIN APP-MEETME -->
	<bean id="meetMeApplicationFacade" class="org.bigbluebutton.webconference.voice.asterisk.meetme.MeetMeApplicationFacade">
		<property name="meetMeApplication"> <ref local="meetMeApplication"/></property>
	</bean>
	
	<bean id="meetMeApplication" class="org.bigbluebutton.webconference.voice.asterisk.meetme.MeetMeApplication">
		<property name="managerConnection"> <ref local="amiConnection"/></property>
		<property name="userStateListener"> <ref local="userStateChangeListener"/></property>
	</bean>
	
	<bean id="userStateChangeListener" class="org.bigbluebutton.webconference.voice.asterisk.meetme.UserStateChangeListener">
		<property name="conferenceEventListener"> <ref local="conferenceServer"/></property>
	</bean>	
	<!-- END APP-MEETME -->
	
	<bean id="amiConnection" class="org.asteriskjava.manager.DefaultManagerConnection">
		<property name="hostname" value="${ami.host}"/>
		<property name="port" value="${ami.port}"/>
		<property name="username" value="${ami.username}"/>
		<property name="password" value="${ami.password}"/>
	</bean>
	
</beans>
